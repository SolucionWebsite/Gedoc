@using Gedoc.Helpers
@using Gedoc.Helpers.Enum

@{
    Layout = null;
}
    <script>
    function currentFilters() {
        return {
            TipoBusquedaBusqAv: '@Request["TipoBusquedaBusqAv"]',
            TipoBitacoraBusqAv: '@Request["TipoBitacoraBusqAv"]',
            FechaIngresoBusqAv: '@Request["FechaIngresoBusqAv"]',
            DocumentoIngresoIdBusqAv: '@Request["DocumentoIngresoIdBusqAv"]',
            FechaDocumentoIngresoBusqAv: '@Request["FechaDocumentoIngresoBusqAv"]',
            RequerimientoAnteriorIdBusqAv: '@Request["RequerimientoAnteriorIdBusqAv"]',
            RemitenteIdBusqAv: '@Request["RemitenteIdBusqAv"]',
            InstitucionRemitenteBusqAv: '@Html.Raw(Request["InstitucionRemitenteBusqAv"])',
            CargoProfesionRemitenteBusqAv: '@Html.Raw(Request["CargoProfesionRemitenteBusqAv"])',
            NumeroOficioCMNBusqAv: '@Request["NumeroOficioCMNBusqAv"]',
            FechaEmisionOficioCMNBusqAv: '@Request["FechaEmisionOficioCMNBusqAv"]',
            MateriaBusqAv: '@Html.Raw(Request["MateriaBusqAv"])',
            RegionBusqAv: '@Request["RegionBusqAv"]',
            ComunaBusqAv: '@Request["ComunaBusqAv"]',
            EtiquetaBusqAv: '@Request["EtiquetaBusqAv"]',
            DenominacionOficialBusqAv: '@Html.Raw(Request["DenominacionOficialBusqAv"])',
            CategoriaMonumentoNacionalBusqAv: '@Request["CategoriaMonumentoNacionalBusqAv"]',
            RolSIIPropiedadBusqAv: '@Html.Raw(Request["RolSIIPropiedadBusqAv"])',
            FechaBitacoraBusqAv: '@Request["FechaBitacoraBusqAv"]',
            UnidadTecnicaAsignadaBusqAv: '@Request["UnidadTecnicaAsignadaBusqAv"]',
            ProfesionalUTAsignadoBusqAv: '@Request["ProfesionalUTAsignadoBusqAv"]',
            CreadorBitacoraBusqAv: '@Request["CreadorBitacoraBusqAv"]',
            FormaLlegadaBusqAv: '@Request["FormaLlegadaBusqAv"]',
            EstadoBusqAv: '@Request["EstadoBusqAv"]',
            EstadoDespachoBusqAv: '@Request["EstadoDespachoBusqAv"]',
            ObservacionAcuerdoComentarioBusqAv: '@Html.Raw(Request["ObservacionAcuerdoComentarioBusqAv"])'
        }
    }

    //# sourceURL=BitacorasTab
    </script>
<style>
    #gridBitacoras {
        font-size: 11px;
    }
    #gridBitacoras td {
        line-height: 1.1em;
    }
    #gridBitacoras .k-grid-header .k-header .k-link {
        height: auto;
    }
    #gridBitacoras .k-grid-header .k-header {
        white-space: normal;
    }
    #gridBitacoras .k-grid-header th > .k-link > .k-icon {
        float: right;
    }
    #gridBitacoras .k-grid-toolbar > span {
        float: left !important;
    }
    #gridBitacoras .k-grid-toolbar > button {
        float: left !important;
    }
    /*#tabstrip > .k-content.k-state-active {
        padding: 0;
        display: table;
    }*/
</style>
<div class="container-fluid-no" id="divResultadoBusquedaAvanzadaBitacora" style="padding:0;">
    @*<div class="form-row">
        <div class="col-md-12">
            <div class="container">*@
                @(Html.Kendo().Grid<Gedoc.Helpers.Dto.BitacoraDto>()
                .Name("gridBitacoras")
                .Columns(columns =>
                {
                    columns.Bound(c => c.DocIngreso)
                        .Width("100px")
                        .Title("Documento Ingreso")
                        .ClientTemplate("#= Main.getTemplateFicha(data.DocIngreso, data.RequerimientoId, data.DocIngreso) #").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.FechaSolicitudRevision).Width(100).HtmlAttributes(new {style = "text-align:center;"}).Title("Fecha Ingreso").Format("{0:dd/MM/yyyy HH:mm}").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Requerimiento.RemitenteNombre).Width(150).Title("Remitente").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Requerimiento.RemitenteInstitucion).Width(180).Title("Institución Remitente").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Requerimiento.Materia)
                        .Width(300)
                        .HtmlAttributes(new {style = "text-align:center;"})
                        .Title("Materia de Ingreso").HeaderHtmlAttributes(new {style = "text-align:center;"})
                        .ClientTemplate("<span title='#:data.Requerimiento.Materia#'> #=Main.acortaTexto(data.Requerimiento.Materia, 100)#" + "</span>");
                    columns.Bound(c => c.Requerimiento.MonumentoNacional.CategoriaMonumentoNacCod).Width(120).HtmlAttributes(new {style = "text-align:center;"}).Title("Categoría de Monumento Nacional").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Requerimiento.MonumentoNacional.DenominacionOficial).Width(120).HtmlAttributes(new {style = "text-align:center;"}).Title("Denominación Oficial");
                    columns.Bound(c => c.Requerimiento.RegionTitulos).Width(120).HtmlAttributes(new {style = "text-align:center;"}).Title("Región").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Requerimiento.ComunaTitulos).Width(120).HtmlAttributes(new {style = "text-align:center;"}).Title("Comuna").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Requerimiento.UnidadTecnicaAsign.Titulo).Width(160).HtmlAttributes(new {style = "text-align:center;"}).Title("Unidad Técnica").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Requerimiento.ProfesionalNombre).Width(150).HtmlAttributes(new {style = "text-align:center;"}).Title("Profesional Asignado").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.UsuarioCreacionNombresApellidos).Width(120).HtmlAttributes(new {style = "text-align:center;"}).Title("Creador Bitácora").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.TipoBitacoraTitulo).Width(180).HtmlAttributes(new {style = "text-align:center;"}).Title("Tipo Bitácora").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.Fecha).Width(100).HtmlAttributes(new {style = "text-align:center;"}).Title("Fecha Bitácora").Format("{0:dd/MM/yyyy HH:mm}").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.ObsAcuerdoComentario).Width(380).HtmlAttributes(new {style = "text-align:center;"}).Title("Observación / Acuerdo / Comentarios").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.FechaUltimoAcuerdoComision).Width(100).HtmlAttributes(new {style = "text-align:center;"}).Title("Fecha Último Acuerdo de Comisión").Format("{0:dd/MM/yyyy}").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.UltimoAcuerdoComision).Width(280).HtmlAttributes(new {style = "text-align:center;"}).Title("Último Acuerdo de Comisión").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.FechaUltimoAcuerdoSesion).Width(100).HtmlAttributes(new {style = "text-align:center;"}).Title("Fecha Último Acuerdo de Sesión").Format("{0:dd/MM/yyyy}").HeaderHtmlAttributes(new {style = "text-align:center;"});
                    columns.Bound(c => c.UltimoAcuerdoSesion).Width(280).HtmlAttributes(new {style = "text-align:center;"}).Title("Último Acuerdo de Sesión").HeaderHtmlAttributes(new {style = "text-align:center;"});
                })
                //.HtmlAttributes(new {style = "height: 800px; width: 200%; display:table-row;", @class = "text-sm-center"})
                .ToolBar(t =>
                {
                    t.Search();
                    t.Excel().Text("Excel");
                })
                .Excel(excel =>
                {
                    excel.FileName("Bitacoras_BusquedaAvanzada.xlsx");
                    excel.AllPages(true);
                })
                .Pageable(pager => pager.AlwaysVisible(true).PageSizes(new List<object> { 5, 10, 30, 100, 250 })
                    .Messages(m => m.ItemsPerPage("registros por página")))
                .Sortable(sortable =>
                {
                    sortable.SortMode(GridSortMode.SingleColumn);
                })
                .Scrollable(scr => scr.Height("100%"))
                .NoRecords("No se encontraron datos.")
                .DataSource(dataSource => dataSource
                    .Ajax()
                    .ServerOperation(false)
                    //.Model(model =>
                    //{
                    //    model.Id(u => u.Id);
                    //    model.Field(u => u.Id).Editable(false);
                    //})
                    .Read(read => read.Action("BitacorasTab_Read", "BusquedaAvanzada").Data("currentFilters"))
                    //.Update(update => update.Action("Grid_Update", "Adjunto").Data("currentFilters"))
                    .Model(m => m.Id(id => id.Id))
                    .PageSize(5)
                )
                )
            @*</div>
        </div>
    </div>*@
</div>

<script>

    kendo.culture("es-ES"); // Tiene el formato de fecha dd/MM/yyyy q es el q se usa en la aplicación, la cultura es-CL tiene formato dd-MM-yyyy

    $(function () {
        kendo.ui.progress($("#divResultadoBusquedaAvanzadaBitacora"), true);

        $(".k-textbox.k-grid-search input").attr("placeholder", "Buscar...");
        //$(".k-pager-sizes.k-label").html($(".k-pager-sizes.k-label").html().replace("items per page", "elementos por página"));

        $("#gridBitacoras th.k-header a.k-link").each(function () {
            var colText = $(this).html();
            var newText = colText + '<span class="k-icon k-i-kpi" style="color: lightgray;"></span>';
            $(this).html(newText);
        });

        $('body :not(script)').contents().filter(function () {
            return this.nodeType === 3;
        }).replaceWith(function () {
            return this.nodeValue.replace('items per page', 'elementos por página');
        });
    });

    //# sourceURL=BitacorasTab2
</script>
